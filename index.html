<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japanese Pitch Accent Trainer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Microphone Permission Modal -->
    <div class="permission-modal" id="permissionModal">
        <div class="permission-content">
            <div class="permission-icon">üé§</div>
            <h2>Microphone Permission Required</h2>
            <p>This app needs access to your microphone to record your Japanese pronunciation and provide voice transcription feedback.</p>
            <div class="permission-buttons">
                <button id="requestPermissionBtn" class="permission-btn primary">Allow Microphone Access</button>
                <button id="skipPermissionBtn" class="permission-btn secondary">Continue Without Recording</button>
            </div>
            <div class="permission-status" id="permissionStatus"></div>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üáØüáµ Japanese Pitch Accent Trainer</h1>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="question-counter">
                <span id="currentQuestion">1</span> / <span id="totalQuestions">4</span>
            </div>
        </header>

        <!-- Main Training Area -->
        <main class="quiz-container">
            <!-- Question Display -->
            <div class="question-area">
                <div class="question-type" id="questionType">Pitch Accent Training</div>
                <div class="japanese-phrase" id="japanesePhrase">„ÅØ„Åó</div>
                <div class="pitch-pattern" id="pitchPattern">
                    <div class="pitch-visualization">
                        <div class="pitch-bar high" id="pitch1">H</div>
                        <div class="pitch-bar low" id="pitch2">L</div>
                        <div class="pitch-bar low" id="pitch3">L</div>
                        <div class="pitch-bar low" id="pitch4">L</div>
                        <div class="pitch-bar low" id="pitch5">L</div>
                        <div class="pitch-bar low" id="pitch6">L</div>
                        <div class="pitch-bar low" id="pitch7">L</div>
                        <div class="pitch-bar low" id="pitch8">L</div>
                    </div>
                </div>
                <div class="meaning" id="meaning">Ê©ã (bridge)</div>
                <div class="example-sentence" id="exampleSentence">Ê©ã„ÇíÊ∏°„Çã„ÄÇÔºà„ÅØ„Åó[HL] „Çí „Çè„Åü„ÇãÔºâ‚Äî "cross the bridge."</div>
                <div class="instructions" id="instructions">
                    Listen to the correct pronunciation, then record yourself saying the phrase with the correct pitch pattern.
                </div>
            </div>

            <!-- Audio Controls -->
            <div class="recording-area">
                <div class="audio-controls">
                    <div class="voice-selection">
                        <h4>Reference Voices:</h4>
                        <div class="voice-buttons">
                            <button id="playMan1Btn" class="voice-btn man-btn" data-voice="man1">
                                <span class="voice-icon">üë®</span>
                                <span class="voice-text">Man 1</span>
                            </button>
                            <button id="playLady1Btn" class="voice-btn lady-btn" data-voice="lady1">
                                <span class="voice-icon">üë©</span>
                                <span class="voice-text">Lady 1</span>
                            </button>
                            <button id="playLady2Btn" class="voice-btn lady-btn" data-voice="lady2">
                                <span class="voice-icon">üë©</span>
                                <span class="voice-text">Lady 2</span>
                            </button>
                        </div>
                    </div>
                    <button id="recordBtn" class="record-btn">
                        <span class="record-icon">üé§</span>
                        <span class="record-text">Record Your Pronunciation</span>
                    </button>
                </div>
                <div class="recording-status" id="recordingStatus"></div>
                
                <div class="transcription-area" id="transcriptionArea" style="display: none;">
                    <h4>What you said:</h4>
                    <div class="transcription-text" id="transcriptionText">Processing your speech...</div>
                    <div class="pronunciation-feedback" id="pronunciationFeedback">
                        <div class="feedback-icon" id="feedbackIcon"></div>
                        <div class="feedback-message" id="feedbackMessage"></div>
                        <div class="accuracy-score" id="accuracyScore"></div>
                    </div>
                </div>
                
                <div class="audio-playback" id="audioPlayback" style="display: none;">
                    <audio controls id="audioPlayer"></audio>
                    <button id="playBtn" class="play-btn">Play Recording</button>
                </div>
            </div>

            <!-- Feedback Area -->
            <div class="feedback-area" id="feedbackArea" style="display: none;">
                <h3>Your Performance</h3>
                <div class="score-display">
                    <div class="score-item">
                        <span class="score-label">Pitch Accuracy:</span>
                        <span class="score-value" id="pitchScore">85%</span>
                    </div>
                    <div class="score-item">
                        <span class="score-label">Pronunciation:</span>
                        <span class="score-value" id="pronunciationScore">78%</span>
                    </div>
                </div>
                <div class="feedback-text" id="feedbackText">
                    Good job! Your pitch pattern was mostly correct. Try to emphasize the high-low pattern more clearly.
                </div>
                <div class="pitch-comparison" id="pitchComparison">
                    <div class="comparison-item">
                        <span class="label">Target:</span>
                        <div class="pitch-bars">
                            <div class="pitch-bar high">H</div>
                            <div class="pitch-bar low">L</div>
                        </div>
                    </div>
                    <div class="comparison-item">
                        <span class="label">Your:</span>
                        <div class="pitch-bars">
                            <div class="pitch-bar medium">M</div>
                            <div class="pitch-bar low">L</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="navigation">
                <button id="prevBtn" class="nav-btn prev-btn" disabled>Previous</button>
                <button id="nextBtn" class="nav-btn next-btn">Next Lesson</button>
                <button id="submitBtn" class="nav-btn submit-btn" style="display: none;">Complete Training</button>
            </div>
        </main>

        <!-- Results Modal -->
        <div class="modal" id="resultsModal" style="display: none;">
            <div class="modal-content">
                <h2>üéå Training Complete!</h2>
                <div class="final-scores">
                    <div class="final-score">
                        <span class="score-label">Overall Pitch Accuracy:</span>
                        <span class="score-value" id="overallScore">82%</span>
                    </div>
                    <div class="final-score">
                        <span class="score-label">Level:</span>
                        <span class="score-value" id="levelScore">Intermediate</span>
                    </div>
                </div>
                <div class="recommendations" id="recommendations">
                    <h3>Á∂ôÁ∂ö„ÅÆ„Åü„ÇÅ„ÅÆ„Ç¢„Éâ„Éê„Ç§„Çπ (Continued Learning Tips)</h3>
                    <ul>
                        <li>Practice pitch patterns daily with native speaker recordings</li>
                        <li>Focus on the high-low contrast in „ÅØ„Åó (bridge vs chopsticks)</li>
                        <li>Work on distinguishing „ÅÇ„ÇÅ (rain vs candy) by pitch alone</li>
                        <li>Practice the long vowel difference in „Å≥„Çá„ÅÜ„ÅÑ„Çì vs „Å≥„Çà„ÅÜ„ÅÑ„Çì</li>
                    </ul>
                </div>
                <button id="restartBtn" class="restart-btn">Start Over</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
